# 6DMHS代码分析文档

## 概述

本文档详细分析了与论文《6D Movable Holographic Surface Assisted Integrated Data and Energy Transfer: A Sensing Enhanced Approach》相关的MATLAB代码实现。该系统实现了一个基于6D可移动全息表面（6DMHS）的集成数据与能量传输（IDET）系统。

## 论文核心概念

论文提出了一个三阶段协议：
1. **上行感知阶段（Uplink Sensing Stage）**：使用全息感知技术获取IDET接收器的角度信息
2. **姿态调整阶段（Orientation Adjustment Stage）**：优化6DMHS的空间位置和全息波束成形
3. **下行传输阶段（Downlink Transmission Stage）**：优化数字波束成形和功率分配，进行IDET传输

## 快速参考表

### 核心文件速查

| 文件名 | 功能类别 | 对应论文章节 | 主要作用 |
|-------|---------|------------|---------|
| `RUN_OPT_Protocol.m` | 主流程 | Section III-B | 完整三阶段协议执行 |
| `Sensing_Algorithm.m` | 感知模块 | Section IV-A | 全息感知与角度估计 |
| `optimize_system.m` | 优化模块 | Section IV-B | 联合优化位置和波束成形 |
| `calculate_EH_power.m` | 传输模块 | Section II-C | 计算能量收集功率 |
| `Channel_Generation_init.m` | 信道模块 | Section II-B | Rician信道生成 |
| `Orientation_Initial.m` | 初始化 | Section II-A | 6DMHS姿态初始化 |

### 测试与绘图文件速查

| 文件名 | 对应图表 | 功能 |
|-------|---------|------|
| `plot_EH_vs_Pt.m` | Fig. 5 | EH功率 vs 发射功率 |
| `Test_Sensing.m` | Fig. 7-8 | 感知性能测试 |
| `Test_6DMA.m` | Fig. 5 | 不同配置性能对比 |

## 代码文件分类与作用

### 一、主控制流程文件

#### 1. `RUN_OPT_Protocol.m`
**作用**：主协议运行文件，实现完整的三阶段协议

**对应论文章节**：Section III-B (Sensing-Enhanced 6DMHS Protocol)

**主要功能**：
- 初始化系统参数（频率fc=30GHz，天线阵列32×32，用户数K=4，全息表面数B=4）
- 执行完整的三阶段协议流程
- 调用各个子模块完成感知、优化和传输

**关键实现**：
```matlab
% 参数初始化
fc = 30e9;  % 载波频率
Mx = 32; My = 32; M = Mx * My;  % 天线阵列规模
K = 4;  % 用户数量
B = 4;  % 全息表面数量
```

**对应论文公式**：实现了论文中的系统模型（Section II）

#### 2. `RUN_OPT_Protocol_with_Pt.m`
**作用**：与`RUN_OPT_Protocol.m`类似，但增加了不同发射功率Pt下的性能分析

**对应论文章节**：Section VI (Simulation Results)，特别是Fig. 5

**主要功能**：
- 在不同发射功率水平下运行协议
- 用于生成发射功率与EH功率的关系曲线

### 二、感知模块（Stage I: Uplink Sensing）

#### 3. `Sensing_Algorithm.m`
**作用**：核心感知算法实现，基于全息感知方法估计用户角度信息

**对应论文章节**：Section IV-A (Holographic-based Sensing Method)

**主要功能**：
- 实现基于FFT的全息图像处理
- 提取IDET接收器的角度信息（azimuth θ 和 elevation φ）
- 在局部坐标系中进行感知信号处理

**关键实现**：
```matlab
% FFT矩阵用于角度估计
F = exp(-1j * 2*pi * (delta_n * delta_n.') / N);
```

**对应论文公式**：
- Eq. (27)-(29): 全息感知接收信号模型
- Eq. (30): FFT-based检测方法
- Theorem 1: 感知精度分析

#### 4. `Sensing_Holographic_HalfWave.m` / `Sensing_Holographic_HalfWave1.m`
**作用**：实现半波长间隔的全息感知

**对应论文章节**：Lemma 2 (关于半波长间隔的充分性)

**主要功能**：
- 在半波长（λ/2）间隔下布置感知元件
- 验证半波长间隔足以实现高精度感知

**对应论文公式**：Eq. (94): d_S ≤ λ/2

#### 5. `Run_Sensing_HalfWavelength.m`
**作用**：运行和测试半波长感知方法

#### 6. `Test_Sensing.m`
**作用**：感知算法的测试脚本

**主要功能**：
- 测试不同感知方法的性能
- 比较全息感知与传统LS方法

**对应论文内容**：Fig. 7-8中的感知性能比较

#### 7. `Benchmark_Sensing.m`
**作用**：基准感知方法实现（如LS-based sensing）

**对应论文内容**：用于性能对比的基准方法

### 三、优化模块（Stage II: Orientation Adjustment）

#### 8. `optimize_system.m`
**作用**：联合优化空间位置和全息波束成形

**对应论文章节**：Section IV-B (Orientation Optimization)

**主要功能**：
- 优化6DMHS的空间位置（translation）
- 优化全息波束成形（holographic beamforming）
- 基于感知信息调整RHS姿态

**关键实现**：
```matlab
% 生成离散空间点
[X, Y, Z] = Orientation_uniformSpherePoints(B1);
% 对每个位置计算导向矢量
a_st_set{k0, b0, k1} = exp(1j * 2*pi/lambda * (a1 * e(:, k1)));
```

**对应论文公式**：
- Problem (P2): 姿态优化问题
- Eq. (34)-(35): 全息波束成形设计
- Algorithm 1 & 2: 交替优化算法

#### 9. `optimize_spatial_position.m`
**作用**：专门优化6DMHS的空间位置（平移部分）

**对应论文内容**：Position optimization子问题

#### 10. `Orientation_Initial.m`
**作用**：初始化6DMHS的空间姿态

**主要功能**：
- 在球面上均匀分布B个RHS
- 计算初始旋转矩阵（Rodrigues rotation formula）
- 设置初始法向量

**对应论文公式**：
- Eq. (1)-(6): 6DMHS坐标变换
- Eq. (2): Rodrigues旋转矩阵

#### 11. `Orientation_uniformSpherePoints.m`
**作用**：在球面上均匀生成离散位置点

**主要功能**：
- 生成均匀分布的球面坐标
- 用于离散化6DMHS的可行位置集合

#### 12. `Orientation_calculateRotationAngles.m`
**作用**：计算旋转角度

**对应论文公式**：Eq. (4)-(5): 旋转向量和旋转角度计算

#### 13. `Orientation_Rot.m`
**作用**：执行旋转操作

### 四、传输与性能评估模块（Stage III: Downlink Transmission）

#### 14. `calculate_EH_power.m`
**作用**：计算能量收集（EH）功率

**对应论文章节**：Section II-C (Downlink Transmission Signal Model)

**主要功能**：
- 基于优化后的配置计算EH功率
- 支持参数化的发射功率输入

**对应论文公式**：
- Eq. (20): RF能量收集功率
- Eq. (21): DC能量收集功率（非线性EH模型）

#### 15. `generate_effective_channel.m`
**作用**：生成等效信道

**主要功能**：
- 计算经过全息波束成形后的等效信道
- 等效信道 = 无线信道 × 全息波束成形 × 电磁响应

**对应论文内容**：Stage III中提到的"equivalent CSI"

#### 16. `Channel_Generation_init.m`
**作用**：初始化无线信道生成

**对应论文章节**：Section II-B (Channel Model)

**主要功能**：
- 生成Rician信道（LoS + NLoS）
- 计算路径损耗
- 生成散射体参数

**对应论文公式**：
- Eq. (10)-(13): 无线信道模型
- Eq. (11): Rician信道增益

### 五、测试与结果生成文件

#### 17. `plot_EH_vs_Pt.m` / `plot_EH_vs_Pt_simple.m` / `plot_EH_vs_Pt_final.m` / `plot_EH_vs_Pt_global.m`
**作用**：生成不同版本的EH功率与发射功率关系图

**对应论文内容**：Fig. 5 - EH power versus transmit power

#### 18. `fig5.m`
**作用**：专门生成论文中的Figure 5

#### 19. `Test_6DMA.m` / `test_6DMA_run.m`
**作用**：测试6DMA系统的整体性能

**主要功能**：
- 对比不同配置（FPA, 仅旋转, 仅平移, 完整6DMHS）
- 验证6DMHS的性能增益

**对应论文内容**：Fig. 5中的不同配置对比

#### 20. `test_main.m` / `test1.m` / `test2.m`
**作用**：各种测试脚本

#### 21. `main1.m`
**作用**：主测试程序之一，可能用于完整系统测试

### 六、辅助工具文件

#### 22. `fun_run_R00.m`
**作用**：辅助函数，可能与吞吐量阈值R0相关

**对应论文内容**：Problem (P1)-(P2)中的吞吐量约束

#### 23. `sig.m` / `p.m` / `vec.m`
**作用**：简单的工具函数

#### 24. `untitled.m` / `untitled.fig`
**作用**：未命名的测试文件或图形文件

## 代码与论文的对应关系

### 三阶段协议实现映射

| 协议阶段 | 论文章节 | 主要代码文件 |
|---------|---------|------------|
| Stage I: Uplink Sensing | Section IV-A | `Sensing_Algorithm.m`, `Sensing_Holographic_HalfWave.m` |
| Stage II: Orientation Adjustment | Section IV-B | `optimize_system.m`, `optimize_spatial_position.m`, `Orientation_Initial.m` |
| Stage III: Downlink Transmission | Section V | `calculate_EH_power.m`, `generate_effective_channel.m` |

### 关键技术实现映射

| 技术点 | 论文章节 | 代码实现 |
|-------|---------|---------|
| 全息感知 | Section IV-A, Eq. (27)-(32) | `Sensing_Algorithm.m` |
| FFT检测 | Theorem 1 | `Sensing_Algorithm.m` 中的FFT矩阵 |
| 半波长间隔 | Lemma 2 | `Sensing_Holographic_HalfWave.m` |
| Rodrigues旋转 | Eq. (2)-(5) | `Orientation_Initial.m` |
| 全息波束成形 | Eq. (22), (34)-(35) | `optimize_system.m` |
| 位置优化 | Problem (P3) | `optimize_spatial_position.m` |
| EH功率计算 | Eq. (20)-(21) | `calculate_EH_power.m` |

### 仿真结果生成映射

| 图表 | 论文位置 | 代码文件 |
|-----|---------|---------|
| Fig. 5: EH vs Pt | Section VI | `plot_EH_vs_Pt.m`, `RUN_OPT_Protocol_with_Pt.m` |
| Fig. 6: EH vs R0 | Section VI | `fun_run_R00.m` 相关 |
| Fig. 7-8: Sensing performance | Section VI | `Test_Sensing.m`, `Benchmark_Sensing.m` |

## 系统参数设置

代码中的关键参数与论文一致：

| 参数 | 代码值 | 论文值 | 说明 |
|-----|-------|-------|-----|
| fc | 30e9 | 30 GHz | 载波频率 |
| M | 32×32 = 1024 | 32×32 | RHS元素数量 |
| K | 4 | 4 | 用户数量 |
| B | 4 | 4 | RHS数量 |
| Q | 1 | 1 | 馈源数量 |
| K_rice | 10 | 10 | Rician因子 |
| Pt | 40 dBm | 40 dBm | 发射功率 |
| d | λ/4 | λ/4 | 元素间隔 |

## 代码执行流程

完整的代码执行流程：

1. **初始化** (`Orientation_Initial.m`)
   - 设置系统参数
   - 初始化6DMHS空间姿态
   - 生成初始坐标

2. **信道生成** (`Channel_Generation_init.m`)
   - 生成Rician无线信道
   - 计算路径损耗
   - 生成散射体信息

3. **感知阶段** (`Sensing_Algorithm.m`)
   - 接收上行感知信号
   - FFT处理全息图像
   - 估计用户角度信息

4. **优化阶段** (`optimize_system.m`)
   - 基于感知信息优化RHS位置
   - 设计全息波束成形
   - 调整6DMHS姿态

5. **传输阶段** (`calculate_EH_power.m`, `generate_effective_channel.m`)
   - 生成等效信道
   - 优化数字波束成形
   - 计算IDET性能指标

6. **性能评估** (各种test和plot文件)
   - 对比不同配置
   - 生成仿真结果
   - 绘制性能曲线

## 核心创新点的代码实现

### 1. 全息感知技术
**论文创新**：提出基于全息图像的并行感知方法，避免传统串行方法的信号混叠

**代码实现**：`Sensing_Algorithm.m` 中使用FFT矩阵直接从全息图像提取角度信息
```matlab
F = exp(-1j * 2*pi * (delta_n * delta_n.') / N);
% 直接从感知元件并行获取数据，避免混叠
```

### 2. 方向性波束增益利用
**论文创新**：识别并利用RHS的方向性波束增益特性

**代码实现**：通过`optimize_system.m`将最大波束增益方向对准用户

### 3. 感知增强的三阶段协议
**论文创新**：使用感知信息降低算法复杂度，从O(M²N²L²)降低

**代码实现**：先感知后优化的两步法，`RUN_OPT_Protocol.m`协调整个流程

## 总结

本代码库完整实现了论文提出的6DMHS-IDET系统，包括：

1. **完整的三阶段协议**：感知、优化、传输
2. **创新的全息感知方法**：基于FFT的并行感知
3. **联合优化算法**：位置、旋转和波束成形的联合设计
4. **性能评估框架**：对比多种基准方案

代码结构清晰，模块化良好，每个文件对应论文的特定章节或算法，便于理解和复现论文结果。

## 建议的代码阅读顺序

1. **先读协议流程**：`RUN_OPT_Protocol.m` - 理解整体流程
2. **再读初始化**：`Orientation_Initial.m`, `Channel_Generation_init.m` - 理解系统模型
3. **深入感知**：`Sensing_Algorithm.m` - 理解核心创新之一
4. **学习优化**：`optimize_system.m` - 理解联合优化方法
5. **最后看测试**：各种test和plot文件 - 理解如何验证性能

通过这个顺序可以系统地理解论文的理论和代码实现之间的对应关系。
