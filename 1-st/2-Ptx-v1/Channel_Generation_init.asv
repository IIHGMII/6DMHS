function [ h , e0 , theta, phi , theta_scatterer , phi_scatterer , IOTA , eta , Omega ] = Channel_Generation_init( K,B,M,Mx,My,normal_vector,K_rice,Coor_Ele,lambda , Rot_Matrix )

    dx = lambda/4;   %x轴方向天线间隔
    dy = lambda/4;  %y轴方向天线间隔
    delta_x = ( 2 * [0:(Mx-1)].' - Mx + 1 )/2; delta_y = ( 2 * [0:( My-1)].' - My + 1 )/2;
%% 针对初始6DMA位置，生成无线信道
PL    = 32.4 + 17.3 * log10( 8 ) + 20 * log10( 30 ) -20 ; % Path-loss,包含20dB天线增益
Omega = 10^( -PL/10 ) * ones(K,B);  % path-loss
IOTA  = 60;         % 散射体数量
theta =  rand(K,1) * 2 * pi; phi = rand(K,1) * 2 * pi; % K个用户的水平角和俯仰角
% theta = 5.263863993147139 ; phi =  1.057064847365129;
theta_scatterer = rand(K,IOTA) * 2 * pi; phi_scatterer = rand(K,IOTA) * 2 * pi; % K个用户的水平角和俯仰角

theta = [0.726327817935366
5.99460688895218
4.82481061751667
1.80921576425667
5.51670665435747
1.59766510995441];
phi = [1.28654795497930
0.984571041253662
3.28460823552619
1.31592040419463
3.35606373605060
3.28335644068415];
theta_scatterer = [5.98329464973068	3.53424319489655	1.32576556925947	5.40299115549867	0.292242407631045	4.86338138421302	5.46929239158739	5.41985377363416	0.957662976558486	0.340449479069228	3.13256737896640	5.71217172828000	3.39428899502395	5.60469265428375	3.10394365758887	0.119886938367309	1.42778029094187	3.26358769758074	2.75575071066046	2.12081849612731	5.90863813412308	6.17911935217900	0.125703117740724	1.12240423846144	0.0379559689082307	1.17684916105613	1.53292224717759	0.786336724899006	0.849163630474045	6.22687963864363	3.58745181149910	0.736492613885462	1.85510445062574	1.59299411162536	2.52512701428517	3.97912123120822	3.60129150988360	0.754616636546251	1.29053796824766	4.72206477400556	5.15056031986489	3.61350530133893	4.23993766746098	0.587611577190603	0.723955256020119	1.82138346304439	2.23101694341223	2.26083341210346	4.38781944226573	5.06000542508947	6.18533763659769	4.75374162964727	4.09950291214045	3.51676845822617	6.00821029015969	4.19400181029933	5.27897984970270	0.405786021380848	3.62967348879227	2.75462546901231
2.78459292818806	3.25782072546239	1.50439156006800	4.06378876252579	3.25289171200182	2.54045220407657	2.58891085271731	0.000718491834420006	5.44423291885640	0.839745027764349	0.968120089667126	6.20424572267909	0.469614724497553	1.09741832035507	1.12356976472415	2.89222867430244	1.04312372199742	4.72080228689837	6.01088479023166	1.71918318517614	2.46723575567415	2.20971406422709	4.71683259734486	2.24241260985840	5.35431195655621	3.88530556530783	5.94717132081917	1.38650081241047	1.94942909308135	3.22282296463936	5.89761595300099	2.64902897288997	5.97226749598903	5.79755884018381	3.41630081596169	2.15324853138518	2.04504777607032	1.00548868971373	5.99140300276935	1.19591408979541	0.706967380103573	2.03036441796828	2.28113294600470	3.91144605314176	3.83441816456027	1.73351076379262	1.84401184062331	1.56410288476210	0.537669183296773	3.09892763291735	3.70434471181863	4.62824760113342	0.0668377542380778	4.12347271380255	1.39475913370327	4.59412898525729	6.23642445604052	0.930086902823866	0.481520328873017	5.81549103309150
4.93344991260272	2.83689113172804	3.58732302004886	5.26696397257940	1.11229290579132	2.60708234649102	0.393348724329309	5.14380936193644	4.48622483111108	3.92496193433370	2.99332059744675	0.362652569645080	0.280437388202781	2.95288578545684	0.193772892769019	5.43599830446046	5.00767978425606	0.703013109951094	4.66257131753754	5.87864526281073	0.897977931657512	5.29353223948761	0.541401858844108	1.50214825135276	2.58028373985311	5.67836721166673	1.34379928967321	1.65705650038473	5.07555573551593	0.862123874619392	3.01281533847846	4.14317187932667	4.41789815661813	2.09812494793676	3.97229961789848	0.0590344081038772	1.32760062979789	4.38976770848844	0.832188092698137	1.21416985934981	0.213591389690897	0.522926668787042	3.19011954010438	1.28342083150047	6.23391889687315	1.00960656421956	1.22930675647911	3.39211288815301	2.93972347284617	6.09690208143590	2.30799195566148	5.94131697691134	4.59337862451543	2.66798684379874	1.09014564072134	0.387783315455120	5.80675854665133	5.51624471495449	1.54230243471483	5.79185830701100
0.699963552913978	2.85030609557548	1.69436748906285	1.04835177675227	1.53403367679637	6.19203560370066	5.61427698904345	2.26700819025803	3.84876816449089	5.45616683709815	4.80461919839839	5.77314475170405	4.55429780958436	3.66401352245298	1.57794459537650	0.125155705132601	1.43852726442752	2.47820341762360	6.16756097001286	5.06495648699884	5.30695468964218	3.98531115972837	1.15724641021873	5.62565121475624	0.740309516137559	0.981654204567637	0.940217176008428	3.79093353614612	3.80224588999730	1.90600501125448	2.18971797262416	2.03454736052386	5.92667551455239	4.31789754024308	5.97891993787039	4.65922673742686	0.932898039036464	5.30474317430020	0.0674337403362430	1.82608709920702	1.30572812856247	0.834122949481760	6.02242032227123	1.75329197769126	0.977859047988638	6.08563544732230	6.19086914974042	0.0686954759508478	3.66149627434178	0.841459453719848	0.684762857785116	2.94055857803747	4.80926372990971	4.76814958260537	5.40521055143704	5.83445141712052	5.93466782816467	3.42547026260705	0.215674315807361	0.543234964144670
3.94649193683353	3.17663499169231	1.96827348143611	2.70958325758427	2.71160141500555	5.71427415259243	5.14695134604423	5.83715078945272	3.81893005791571	2.44043690757002	4.51924663587702	1.43935218793105	4.88708935221304	0.164536010509718	0.519479000538811	0.848373854867863	5.02234252936064	3.03983137478489	5.67703137723929	6.12310529123214	4.12520889190123	4.11822748471979	5.28515389694062	5.76854404047164	5.45924689243647	4.82174587751673	2.07058250977233	1.70688427203545	2.85209620214461	5.25553599105317	1.70943321781300	1.80408419665728	3.49860091639598	1.21914616519711	2.74700062676649	1.95238774129107	2.58586700980993	0.321609122998032	0.911122841867767	2.38145859626652	1.38878273967932	0.550787551134308	2.93872749248196	5.05224547270888	0.980906247584368	1.53095771511061	5.92450197131900	3.71728053037145	1.74446997740578	4.21487544379855	3.22925343746335	2.54833082687860	3.36941866040834	3.06505982294061	2.77266936009670	5.17060487351889	2.19864678729001	1.54402601275489	1.15543917490539	4.53012745069756
4.91356533741807	4.42794064211707	4.13335493942606	3.85504829548977	5.72867567153489	2.86723075503014	6.09529721226992	0.0799697610352324	2.67661529981825	1.98823904607703	1.16779285837097	5.91841301440521	3.57522516826369	3.78903205417657	2.22871278525108	5.33339967722513	5.02134864771230	2.24258041303281	3.42933727417606	2.07412486857937	5.95729076432524	5.09672239143357	0.639736262373399	4.67914695698886	2.53140135631354	3.83748684335517	1.68435675186691	3.12406100434379	2.56513784781431	4.37221704792905	1.88067661629017	4.23407948340092	2.89344240102882	5.76175161895768	0.152580732629364	1.46602764280497	1.89113552280519	0.0310651337466976	2.88019390714188	2.74476836860363	4.81254987897376	2.86187164068981	3.61345547421590	1.79591274700985	2.64429856712416	2.83176953789424	0.827025668061658	4.48003695490051	2.71893182461987	1.62055014127529	1.68022933885386	3.86825082281022	6.22039521705156	5.72077678951727	0.334433472271687	2.93532813216748	5.03032696833750	4.07654930058873	0.787154088640645	0.566509556173856];
phi_scatterer = [ 5.16740276579553	2.51791677228161	0.0843070585168235	0.568562946972560	1.53106559885058	2.04466717333007	5.54512939703796	4.10216258639087	6.08741229228981	3.83835746177005	1.23100697736633	2.98764178023873	4.35856066358168	5.05314195477362	4.35095523867488	2.86802590319672	4.69419799412513	5.03760238169622	2.58069517232339	0.693169393523672	4.88602828148521	0.595346602287882	5.36112749427605	2.62769717346986	2.61604503822719	2.27325167224962	2.08274383742307	5.89109759237106	1.51964709268201	4.30156354158877	4.85363344504943	5.24978666274389	2.55367982023579	1.24618011825644	0.916648910287727	1.11516996906973	3.27075833551500	5.11587601705647	5.84991805940011	3.00050609134314	3.60857956694382	3.40597757833764	4.71055738000022	2.67529853678665	2.52331300415312	2.28868825179172	2.09676998037532	2.70704738539047	5.27251106930369	2.78202669405760	1.12416497524521	6.19275145053704	2.61681786313892	3.13567812506202	1.49500128753514	1.96739569850756	4.09540420115041	0.419792117688027	3.60967104404461	2.78714812489832
2.87854316187839	1.26100055108823	4.66472366340039	5.08014468070719	0.943302999675291	0.461482318155630	1.79487846903954	3.32689758255732	1.69017105195045	1.72822037194862	6.22898322068778	1.63950499234597	2.35707755739053	5.05797928521622	2.22349558318498	3.39582939172355	3.49943820162357	4.12010052036749	0.434997133000394	4.26034374517912	5.18276422240336	0.0723230210409413	4.13700645674040	1.24897952360842	3.31562410003906	0.918927255613883	2.01430680779839	1.51665581512145	1.97230602079424	4.49461337161921	2.71864420781038	0.520279010072009	2.88427348460510	1.72073337955263	0.909960858881276	0.577307083022123	0.388181651131051	2.38458279784203	5.28790598345209	2.91687236149430	5.54495275819161	5.91857453525040	5.84230774419558	5.22170230689735	4.52868018530367	3.44024841445667	2.75099375702736	4.99158843017071	2.98035117531713	0.125457172402172	2.20273163491164	4.38176284092273	1.33013583630243	0.794731287525355	5.23927849366239	0.807288753186872	1.50111527594301	4.45507053210650	5.21943469413852	0.510391607729957
1.60102295892262	1.08850505768858	3.36382991600339	2.43627615607531	2.10624212074851	0.838829608253709	0.624245019646941	1.82215931629628	3.41237249656818	3.89452897136738	5.13938203264866	4.15949192587722	5.52864254780147	1.81576649362415	4.09917094661825	5.38684718981212	3.93973458068555	5.04266028107270	2.79344233191205	0.148900817007324	0.475947341731291	6.15002370778035	2.01532574992794	2.94720234634272	0.265261866098178	3.91940811592709	5.67268647639857	5.95754313895117	2.17829911493893	1.45996475966967	6.25595604800043	5.81554068534129	4.58735501061085	0.710771746129651	1.51698728709689	3.78784938961693	3.54315165926035	1.62678200487937	3.96511286185345	4.07310471202577	1.22875522154879	3.95731495194056	0.505710863380984	2.09838134921774	5.19905618937278	3.06471837347374	1.17064047441446	0.866684314849522	4.68940529541508	4.69862181857039	5.53043201124063	4.98342353237095	0.360931100356354	4.49998218512474	2.48004239811962	3.10926488679439	3.74555341811123	4.48371203263961	3.91181089552717	5.28873252194407
5.24817633657819	5.12203638845821	1.63075257367670	0.0796997221673428	6.18255219035722	2.76138904735457	0.920221348654973	2.77260855844464	5.27520557858601	3.49196583550756	0.629512723147557	6.21318991031002	1.71200211083709	5.38478341572224	4.05089176769242	5.50339431573603	0.612508113295402	2.90960493242390	4.20404716852943	4.33594560620410	2.41416835423820	2.27695572474760	1.67049198292310	2.47866623108197	6.22643531743624	1.35991416280148	2.17814012690104	4.41683690982724	3.21706960652403	3.70169923144844	2.09700294209020	1.85706931555264	2.23853424042511	5.34808502851272	1.76310627350676	1.64648415670590	5.84768795010273	3.89040948495930	2.59811781246287	4.23181088471910	0.783990783872549	2.86016494633987	4.19909972232150	0.235222468460423	1.71927009717870	4.13034657566862	2.19825343158843	6.26611405388274	2.06887945412359	0.391091160994085	3.58892170240295	0.991242818440918	0.268267416842616	0.834560966429730	1.17153493489964	0.994492747358486	5.42086014443398	2.94851568786577	4.04569231332489	4.45205854182861
4.11599311914816	2.06174024516756	4.20914813631598	5.77971168925460	5.88511480305132	0.139040528286125	6.18513783943038	4.03911279153244	0.798459536897547	5.26525381214183	5.97833710213057	1.76438852794236	5.46209112798202	1.46281652174211	1.22692702743886	2.79754942075226	0.0762547519004448	0.835615209211771	2.37900318559653	5.95048250213257	3.05928332558189	4.37424573615779	0.425175413710871	1.93252650957367	5.38030128039462	1.44071840372037	1.55611423066468	3.07873805296951	2.69942144184040	0.0805347913795312	2.94241126551414	3.85522405144380	5.02978549545503	2.02547901535688	3.55742297136003	2.11689622791660	4.01201141935507	2.70738587472098	2.59121737036636	2.14371969661012	2.73769351269531	1.39404268600797	5.96701350191227	1.83075563550593	4.04801278592412	0.798933630065014	0.250033905511512	5.20686335484675	4.87281071030969	2.22377614472727	4.98540273710691	3.05945812982454	0.218442940461721	4.96029058518501	3.64971704819053	6.26394793987270	4.59815370965572	1.03166280319662	4.60298483958209	1.24602719142440
2.71425916735117	2.17408464933961	2.30500522026516	2.92562445950393	5.63449342012046	2.05879667945786	1.19971142454399	4.77051719533225	0.905953302207926	5.34067221500599	5.53050990480104	0.849450160922001	0.161219804264186	4.39195103070956	5.42883344495711	0.865316833764337	5.05864272563831	0.558056265119634	0.957435184369077	4.36166644735049	3.60778300808710	0.245179849926764	2.50454725273847	1.60271062946812	5.35705027306096	2.40776626032068	2.21056550983106	4.20517920193316	2.44210561444595	0.962675441221146	4.43450929153953	6.05357225083997	5.42776004793040	3.72672861404508	3.28706619847853	2.17443064750926	3.85265328192321	6.00028525498213	2.37946487130661	5.35623783330128	3.64859757657088	2.06037424578198	5.87926979995523	2.24949920842666	3.98871470177013	3.24418482507402	2.17268062970492	0.342990864497506	4.58940156135254	0.982436783281692	4.45136897536125	5.98822538833813	4.86484122560005	3.51849073677701	3.48061144585624	2.51190436203681	0.221614668910035	4.07782853008375	2.25633318626992	0.805337623823071 ];




%% 生成无线信道
% LoS链路信道
for k = 1:K
    for b = 1:B
        h{k,b} = sparse(M,1);%%%%%%%%%%%%%%%%%%%%%注意
            e0{k} = [ sin(phi(k)) * cos(theta(k)) ; sin(phi(k)) * sin(theta(k)) ; cos(phi(k)) ];
            % e = Rot_Matrix{b}.' * e0;
            if dot( normal_vector{b} , e0{k} ) > 0
                Lambda_LoS(k,b) = 1;
            else
                Lambda_LoS(k,b) = 0;
            end
            h{k,b} = sparse( h{k,b} + sqrt(K_rice/(K_rice+1)) * sqrt(M) * sqrt(Omega(k,b)) * Lambda_LoS(k,b) * 1/sqrt(M) * exp( 1j * 2*pi/lambda * Coor_Ele{b} * e0{k} ) );
    end
end

%% 测试
for b = 1:B
    Px{b}    = dx * Rot_Matrix{b} * [1;0;0];
    Py{b}    = dy * Rot_Matrix{b} * [0;1;0];
    T{b}     = exp( 1j * 2*pi/lambda * ( kron( delta_x * ( Px{b}.' * e0{1} ) , ones(1,My) ) + kron( ones(Mx,1) , delta_y.' * ( Py{b}.' * e0{1} ) ) ) );

end





% NLoS链路信道
for k = 1:K
    for iota = 1:IOTA
        eta(k,iota) = 1/sqrt(IOTA) * Omega(k,b) * 1/sqrt(2) * ( randn(1) + 1j*randn(1) );
    end
end

eta = [-2.23201249312090e-07 + 1.23363744913835e-08i	-9.30965550181147e-08 + 9.00222797649764e-08i	1.36362994057056e-07 + 1.60112776260624e-07i	3.30573007544031e-08 - 1.88327551843411e-07i	2.06584522989973e-08 - 3.66527875614376e-08i	9.63782459142201e-08 + 1.04134768060038e-07i	-9.14312346041710e-08 + 2.00721537866682e-07i	-1.85490682405578e-07 + 6.24239200697320e-08i	1.71970279494192e-07 - 1.91950659673717e-07i	-9.24001236323419e-08 - 2.51833081642046e-09i	-2.87844724575232e-07 + 1.36391884328200e-07i	1.58515999732693e-07 - 8.30111770115785e-08i	7.03270586973965e-08 - 1.14989590080586e-07i	-8.59573141593867e-08 - 1.34540934606526e-07i	2.20388432208407e-08 - 1.50176748916411e-07i	-1.08483668175892e-07 + 1.36770484565358e-07i	-3.74281267451020e-07 - 1.68666370136754e-07i	-2.36447443385077e-07 - 3.67816362407397e-08i	-3.64249163889691e-08 - 4.13427788382726e-07i	-3.96122128042402e-08 - 6.82837049703097e-08i	1.80386477939924e-07 + 7.34734020290584e-08i	-1.28896292497673e-07 - 2.58078155982910e-07i	5.19492246097218e-08 - 3.06597941363968e-07i	-8.58631752318457e-10 + 9.30713449423021e-08i	-4.64377260818514e-08 + 1.33444811569137e-07i	1.99843928671591e-07 + 6.26572774430918e-08i	3.08293043549887e-08 - 6.43076486165704e-09i	2.51371693807299e-08 - 1.61569836917454e-07i	-5.39799148348778e-08 + 2.44804554084181e-07i	-2.18626270016259e-09 - 1.24279522787257e-07i	3.15668621300505e-08 + 3.03842942231685e-08i	1.98948317682238e-07 - 7.59408960772678e-09i	1.61093153973079e-07 - 1.14383368783369e-07i	1.34149413455254e-07 - 1.10864240655930e-07i	1.12325708117001e-07 + 3.12755613401092e-08i	-1.52716840749178e-07 - 7.81671197369060e-08i	-1.35680995109765e-07 - 1.28374597312292e-07i	-9.73093145047010e-08 - 1.74041639638914e-08i	-3.59968229823101e-07 + 2.39174511876612e-07i	1.72891389106806e-07 - 1.23506041166076e-07i	-5.34009558769483e-07 + 2.27020093288629e-07i	-1.26964221324476e-07 + 9.66113326795778e-08i	5.98847217397341e-08 + 1.89721983200804e-08i	1.06720427765614e-07 - 1.32594214913852e-07i	-6.12415869210452e-08 - 7.19630172001377e-09i	-4.07706256536907e-07 - 4.51227473527402e-07i	1.92828303091859e-07 - 2.14068790628242e-07i	2.93277707710273e-07 + 1.54492321535929e-07i	-1.68043012020477e-07 + 1.82471347584621e-08i	-1.99512622387427e-07 - 1.73650426602920e-07i	1.86473532262818e-08 + 2.07609308835370e-08i	1.01895580015686e-09 - 7.57648102593699e-09i	-2.01075238320347e-07 - 5.69944347529413e-08i	-1.90017814022646e-07 + 2.36542706762197e-07i	6.38539036427167e-08 - 1.01662026573417e-07i	2.14266246342036e-07 - 2.05286105959745e-08i	2.62034756097007e-08 - 5.15125640426025e-08i	-2.35686051258117e-07 - 2.26090818866538e-07i	1.35365359759561e-07 + 3.06658088533495e-07i	2.87458615800097e-07 + 3.14519615112151e-08i
-1.21973894864982e-08 + 2.56753171959832e-09i	-1.09754163059135e-07 - 1.23269384769730e-07i	-1.40510625571746e-07 - 2.02139587798199e-07i	9.56546372477007e-08 + 1.32658647485340e-07i	-1.67586913181363e-07 + 4.24391860036152e-08i	-5.96948463578181e-08 + 9.07767538268863e-09i	-5.82386872050178e-08 - 5.18608568305376e-08i	3.01606348663552e-07 + 2.50571295107801e-07i	-1.39642615988469e-07 - 1.59407295910008e-07i	1.63367712264860e-08 + 5.20106775823880e-08i	-1.17985939531420e-07 + 3.13645031809219e-08i	2.47998520373310e-07 + 1.37213656086219e-07i	-2.12587674989723e-07 - 4.17851569801699e-08i	1.11287116121362e-07 - 8.92743459702888e-10i	2.12725319519875e-07 + 1.69562730895997e-09i	2.93192464817592e-07 + 3.62442002608125e-08i	7.13902744704687e-08 + 4.08329321780084e-08i	7.92280920722699e-08 + 1.33207295969572e-07i	-7.18451411416584e-08 + 5.03983987827077e-08i	-1.10419003057165e-07 + 3.72321797321637e-08i	-1.62021061743381e-07 - 2.18152510734283e-07i	1.74473000555183e-07 - 8.32978897619123e-08i	-3.73328939656628e-08 + 1.83926440086067e-07i	1.04867825259718e-07 - 1.02013997925210e-07i	1.40090340398099e-07 - 3.40931073031280e-07i	-1.42817092462388e-07 - 1.31274624814919e-07i	2.49078812837427e-07 + 1.64032569031726e-07i	-1.60671061690767e-07 - 3.14238487293652e-08i	-1.15318169031760e-07 - 3.64637677740143e-08i	1.36503500835264e-09 + 1.01330123266672e-07i	8.98622261146981e-08 - 1.38839182527655e-07i	-4.67536045421497e-08 - 7.35884743036949e-08i	1.31134394412877e-07 - 9.85728766617895e-08i	-1.26498763071403e-08 + 7.02721976374014e-09i	-1.18888576880986e-08 + 1.29589621274285e-07i	6.85992980584475e-08 + 4.63149394151724e-10i	-1.09833463966039e-07 - 2.37448300425737e-08i	1.11891086664849e-07 + 8.78619810573346e-08i	-5.55311577869852e-08 - 2.17361538840321e-07i	2.95501006891619e-08 + 1.05947836343290e-07i	-1.39841825481694e-07 - 2.31769986716544e-07i	-7.09823280133982e-08 - 2.14794650421142e-07i	1.42758644657688e-08 - 1.52304732074605e-07i	2.67509924982889e-07 + 3.40840972380023e-07i	-6.00751774787440e-08 + 2.23651202011151e-08i	1.56889697223346e-07 + 2.07882098327411e-07i	-1.20186563937118e-07 + 2.82496002576316e-07i	-2.07402449236920e-07 + 1.23053936287159e-07i	-3.54831487571938e-08 - 9.69224142160142e-08i	2.44193308989740e-07 - 1.15739637908346e-07i	2.42100834629749e-07 - 2.16458876280696e-07i	2.19321952466651e-07 + 8.75643191380811e-08i	9.13542790491479e-08 + 3.49407152103198e-08i	2.13289265323050e-07 - 7.31071231860547e-08i	-9.95493360463609e-08 - 8.79318244667998e-08i	1.01377085252573e-08 - 7.38249286819128e-08i	-1.15879196545190e-09 + 1.22364555557976e-07i	-2.06789855456475e-07 - 6.42595404741277e-08i	5.24451647280523e-08 + 3.93904534964914e-07i	2.09556237833738e-08 + 1.56951952943498e-07i
7.17158680005172e-08 + 9.76278372926348e-08i	1.97248699918753e-09 + 1.31102492572786e-07i	-1.68951083790880e-08 + 4.34885532940621e-08i	1.55682225092023e-07 - 4.37192066236972e-08i	-1.29618894639450e-08 + 2.28353664231612e-07i	-2.60520175923795e-07 + 8.05509258744533e-09i	-1.72989215851832e-07 + 1.32992903163798e-07i	-7.37421520185003e-08 - 6.15245679991367e-08i	1.50068921518248e-07 + 1.95648908102825e-07i	1.98837719580476e-07 - 2.08738046284294e-07i	-2.51962914816991e-08 + 1.10815442678205e-07i	-1.41884717547400e-07 - 2.36652592583549e-07i	-4.10851752042767e-07 + 2.65465167955878e-08i	-1.00745821188679e-07 + 1.86665323249719e-07i	2.37287143099388e-07 - 1.49069818360430e-07i	-1.42233893185522e-07 + 4.04216728385578e-07i	-7.07730294829525e-08 - 2.44020604054985e-07i	4.27067779588189e-08 + 2.03844393807814e-07i	-4.60242262202102e-08 + 1.73634384405784e-07i	-1.04322499587044e-07 - 2.08356445792315e-07i	-3.44913623105351e-08 + 8.15093748522155e-08i	7.40829687066653e-08 + 1.17837597735016e-07i	2.52852873253114e-08 - 1.35462464667230e-07i	5.14536734838025e-08 - 1.99664767362339e-07i	-1.36733494568346e-07 - 8.53498022680012e-08i	1.32452711343452e-07 - 1.10076489332666e-07i	2.13552731829109e-07 + 8.99585330320866e-08i	-1.15819100708510e-08 - 3.85400747243955e-11i	-2.10880869172372e-08 - 1.73397876145271e-08i	-1.46849954374931e-07 + 1.37274502718534e-07i	2.84846121428355e-07 + 4.43405936150559e-08i	1.23853406160328e-07 - 9.17568754587855e-08i	2.74615779353713e-08 - 4.72393186217206e-08i	-2.36447087856403e-07 - 1.43095628788201e-07i	-1.19088684895696e-08 - 1.32481968495663e-07i	-2.89715056614554e-07 + 9.10992337754887e-08i	2.56699996117493e-08 + 5.80663803195998e-08i	9.74588546636945e-08 - 1.22419568409087e-07i	-2.36829501216045e-08 - 1.64972227200793e-07i	-3.16506385862269e-07 + 3.96336189140379e-08i	1.15608994176024e-07 - 2.66256685386223e-07i	3.38560273833162e-07 + 1.04230654460473e-07i	2.53513647405962e-08 + 2.15132999591218e-07i	-2.55028916560752e-07 - 1.63225650431961e-07i	-3.16551303064566e-08 - 7.29537531913031e-08i	-3.43446906410733e-08 + 2.60637604236951e-08i	8.18768416258143e-08 + 6.30120492079975e-08i	6.11871000040036e-09 - 2.94131968109204e-07i	-6.79579714019285e-08 + 3.19190258523261e-08i	1.73681306314692e-08 + 8.20182205315277e-08i	-5.71750763544359e-08 + 1.74147427705757e-07i	1.40389321590961e-07 + 1.18051629916801e-09i	3.60276036494881e-07 + 1.48955684948436e-07i	1.16901545046276e-08 + 1.40223343504128e-07i	-4.92722133945419e-07 - 1.18445610158154e-07i	-1.00505952329310e-07 - 2.13273124617487e-07i	-2.41197747230396e-07 - 9.26120464340924e-08i	-7.00860206352789e-08 - 9.33966783021999e-08i	-1.15283354257138e-09 - 1.15131299061234e-07i	1.79638602745413e-07 - 3.71915426142226e-07i
-2.36434526866106e-07 + 1.18143050400838e-07i	-2.23508477552740e-07 - 2.39754045435041e-07i	-4.65699415927440e-08 - 2.02624908623241e-07i	-7.12074254009919e-08 - 1.09988249077406e-07i	2.27556297184582e-08 - 6.17233531578318e-08i	1.53290052562806e-07 + 6.08547813166084e-08i	1.30990056786969e-07 + 2.36287724872895e-07i	6.15147597030758e-08 - 2.78434880643088e-09i	-7.07642845575220e-09 + 2.72560960734766e-07i	6.18176822025942e-08 + 1.12115393829053e-07i	7.98644520971025e-08 - 2.34910544215263e-08i	-6.25221728435900e-08 - 1.25662200778303e-07i	1.61226249372477e-07 + 7.40707085527269e-08i	-1.21164358430019e-08 - 3.39586702436884e-07i	-1.14345515197780e-07 + 7.77964741638790e-08i	-1.58153401076850e-07 + 3.10505034234632e-07i	-1.66908142511218e-08 + 9.50111409398725e-08i	2.02106677566366e-07 - 1.41328346832394e-07i	2.84039236727927e-08 - 7.28039988919799e-10i	6.18516330987891e-08 + 2.77454815528068e-07i	2.48882784346134e-08 - 2.07950705645150e-07i	-2.72549699432276e-07 + 3.87921617081178e-08i	-3.74632846065961e-08 + 1.16873272571007e-07i	1.12036314681284e-07 - 2.07242879541067e-09i	-4.66396352599300e-08 - 4.83542219772362e-08i	-1.25389293016984e-07 - 3.86097865241599e-08i	-1.04680470510065e-07 - 2.59101732622733e-08i	-4.08938380897548e-07 - 1.34995727694878e-07i	-1.92171371003319e-07 + 1.80419234782217e-07i	-5.10584226619439e-08 + 2.02861718793185e-07i	-1.17650858856526e-07 - 7.25535217912785e-08i	2.60548570850737e-07 + 1.27381884422229e-07i	-1.61713059965406e-07 - 9.09189319168327e-08i	1.73797495079644e-07 + 1.43288054913147e-07i	-1.98333775308667e-07 + 1.67321737989427e-07i	1.50538053467951e-07 - 1.20268689507443e-07i	1.05673267439991e-07 + 1.28953843011856e-07i	9.78597313252750e-08 - 7.21920252668436e-08i	4.53739935487708e-08 + 1.11901795179026e-07i	3.55665611884114e-09 + 1.41956606659016e-09i	2.16299905880087e-07 + 5.78684348494076e-08i	1.36548568800837e-07 + 1.04730845146215e-07i	-1.68052691168269e-07 + 8.43994216947719e-08i	-1.78404719766144e-07 + 8.36852010754778e-08i	-3.61598158202094e-08 - 4.75323729572497e-08i	1.06923286897555e-07 - 1.68680689887686e-07i	7.59636916187469e-08 - 2.45896472263946e-07i	-3.13718232453656e-07 + 6.00459948892906e-08i	5.15965594509792e-08 - 1.73606893200834e-07i	2.45406655997152e-09 + 5.40574843909241e-08i	-1.63769406389422e-07 + 5.49482975019118e-08i	7.71822182589871e-08 - 1.32137434436560e-07i	-1.04991261069853e-07 + 2.91714703231258e-07i	3.04417774149914e-07 - 1.04044190501336e-07i	-4.62927795908141e-09 - 2.40514233088234e-07i	3.60346281171255e-07 + 5.15066516487790e-08i	-1.21275459929359e-07 + 3.11264218717519e-07i	-1.16899080924029e-07 - 1.78230711654016e-08i	-8.80749181357141e-08 - 1.30611894097747e-07i	4.77718744178627e-07 - 9.34969509840225e-08i
2.06849838551690e-07 - 1.87581447967374e-07i	6.57052278164397e-08 - 9.61817437205300e-08i	-2.70834140038765e-08 - 2.73282161178541e-07i	4.57471660481198e-09 + 2.20070932045880e-07i	-1.97237135586120e-07 - 2.21245574814691e-08i	-3.25625832252401e-07 + 1.99775787202079e-08i	-7.36180588978176e-08 + 2.15917768963240e-07i	6.32216983954184e-08 + 2.71556688614437e-08i	-1.27289532065815e-07 + 4.01608382006734e-08i	-8.03390183550963e-08 - 2.25473618970348e-09i	2.35026157871383e-07 + 2.63672126667247e-08i	-2.16652285291801e-08 - 1.25649120929037e-07i	3.78326857777754e-09 - 1.21750893280030e-07i	1.62336068619739e-07 + 2.69914758781034e-08i	-5.25707208524784e-09 + 7.23410842556577e-08i	-1.73686384170744e-07 + 1.87334415536347e-07i	6.19560762218894e-08 - 1.43595767016124e-07i	1.76136075212103e-07 - 3.17109103650553e-07i	-1.60464332633500e-08 - 4.32224098862053e-08i	2.76629304667880e-07 + 2.19344725645528e-07i	-1.08892271146097e-07 + 8.45974940569587e-08i	2.78431449052174e-07 - 8.22988487307752e-08i	-3.50669811776149e-10 + 9.65576086760405e-08i	2.87725798268411e-08 - 1.55189691196763e-08i	7.15193462490777e-08 - 2.46962917901714e-07i	2.15965585839530e-08 - 2.36105101152439e-07i	-2.01210985082796e-07 + 1.91639512378153e-07i	-4.62233153911229e-08 + 2.84067834932753e-08i	1.08863145095991e-07 + 1.08496530193854e-07i	2.52637723933484e-07 - 1.07219205226445e-07i	-8.10847892762064e-09 - 4.35052860807419e-08i	7.82433480185468e-08 + 9.53220130047291e-08i	-8.49521908295130e-08 - 1.50400951859565e-09i	2.86870327831570e-07 + 6.94206338280449e-09i	1.96975856914093e-07 - 2.74311396149463e-08i	-2.00114084575518e-07 + 1.19211360545128e-07i	-1.41135009233270e-08 + 2.12116221687789e-07i	-1.64314839311605e-07 + 1.39016866997046e-07i	-1.63402480318881e-07 + 1.22839571675959e-07i	9.29174657465154e-08 + 1.19776795652717e-07i	3.20639646432564e-08 - 7.16479611032600e-08i	3.63074956077028e-07 + 3.82961837855133e-07i	-2.69370757388162e-08 - 7.85837683030100e-08i	-1.71488890006360e-07 + 8.30402252454862e-08i	2.84555343257575e-07 + 1.57465344787862e-07i	9.11646227791816e-08 - 1.42649812163394e-07i	2.35890387225197e-07 + 2.29082162164052e-09i	2.70877190658155e-07 - 1.33332121884082e-07i	2.28161422783749e-07 - 1.30802262442897e-07i	-2.57615830390807e-07 - 2.32034197072233e-07i	2.90683115014613e-08 + 3.00757478464636e-07i	-2.66422941438376e-07 + 5.23548070507359e-09i	-1.00838782016195e-07 + 1.02490728023566e-07i	2.12624877901089e-07 - 1.89902489885772e-07i	-6.51744923533940e-08 - 9.84006053344911e-08i	-1.91643694646390e-07 - 1.85338650129374e-09i	7.28262293193534e-08 + 6.25704630590712e-08i	1.13020813248939e-07 + 4.96858386992258e-07i	-2.19522557744499e-07 + 2.80801858221379e-07i	1.93920111177597e-08 + 1.75957242417541e-07i
1.27209529252824e-07 + 1.30587593387296e-09i	6.60161736567310e-08 - 1.25370424452802e-07i	-4.08913183845668e-08 + 7.05721639362926e-08i	-2.35496446464160e-07 + 1.07700008943226e-07i	-4.82410608751624e-08 - 3.44042518493146e-07i	1.08855172800628e-07 - 2.72225325770090e-08i	-1.95649166183499e-07 - 1.26756379842956e-07i	-8.39431217026643e-08 + 4.94986374857247e-09i	3.04791005330038e-08 - 2.53504195678966e-07i	1.98124321695904e-07 + 2.38060618289444e-08i	5.34731955525086e-08 - 7.88741805916042e-08i	1.99566497805273e-07 + 3.64056948236249e-08i	-2.09636097457543e-07 + 1.19439900648585e-07i	-1.27129815577245e-07 - 1.59718151562909e-07i	1.32014286196885e-07 + 1.93454241471834e-07i	-3.83989265134094e-08 + 5.14440649399468e-08i	1.81806586887900e-08 + 3.56679659328250e-08i	-7.81336790295051e-08 - 3.24668375351142e-09i	1.47412325085960e-07 - 2.05656740717614e-08i	4.12436316781462e-08 - 2.44919915909641e-08i	-7.23943815083250e-08 - 1.49999695273516e-07i	-7.67100126163775e-08 - 2.60738384765770e-08i	-5.14491005199996e-08 + 2.74412940973788e-07i	-8.53411979231050e-08 - 2.50530224617118e-07i	-1.09058756123058e-07 + 6.91252691075331e-08i	-2.11833054261778e-08 + 2.71280185112297e-07i	1.93690124178573e-07 - 1.03654010078462e-08i	-1.47747783768688e-08 - 5.90481660637421e-08i	-2.27564984311621e-07 + 1.97413830619937e-07i	-1.42023784166003e-07 + 1.26326962043105e-07i	6.42796096442484e-08 - 1.46612587985032e-08i	2.15310305929454e-07 + 1.66540601591970e-07i	1.57907600812953e-07 - 1.63880990558873e-07i	-1.06402808257471e-07 - 1.17170776752151e-07i	-9.55385267398537e-08 - 1.14862696900074e-07i	6.05734145336035e-08 - 4.58000398911952e-09i	2.31987525042750e-08 - 2.06941604502038e-08i	-1.70296002117736e-07 - 3.25874260735390e-07i	2.05845767969112e-07 - 1.02933772379347e-07i	4.53547170992831e-08 - 6.64552061319529e-08i	-6.45883492988717e-08 - 2.06445984876971e-08i	4.82010698165457e-08 + 2.36347954107123e-07i	-3.67132258760868e-08 - 6.36320093028067e-08i	3.79569624448764e-09 + 5.85174527447025e-08i	-6.77489534663684e-08 + 1.16403582766575e-07i	6.25886777400850e-08 + 2.96003116269682e-08i	-1.02206961675524e-07 - 2.87025434413119e-08i	-2.77648751872470e-07 - 2.20690434610055e-07i	2.03845161264853e-07 + 7.04304881661161e-08i	7.77712064131140e-08 + 1.58742086411752e-07i	2.70279210524718e-07 + 1.21148731172237e-07i	1.28994209443205e-07 + 7.75766190555656e-08i	-2.24666970356099e-07 - 6.87809579245034e-08i	3.21858286025607e-07 + 7.97012437934015e-08i	1.00165669482692e-09 - 1.12000169080041e-07i	-1.56537398255453e-07 - 1.82637088891104e-07i	-2.06002169676861e-07 - 2.75256853558292e-08i	2.47078076582469e-08 + 9.68682343853117e-08i	-2.09376777413972e-09 + 1.38098691971863e-07i	2.33634469386608e-08 - 6.79242136274350e-08i];

for k = 1:K
    for b = 1:B
        % h{k,b} = 0;%%%%%%%%%%%%%%%%%%%%%注意
        for iota = 1:IOTA
            % eta(k,iota,b) = 1/sqrt(IOTA) * Omega(k,b) * 1/sqrt(2) * ( randn(1) + 1j*randn(1) );
            e1{k,b} = [ sin(phi_scatterer(k)) * cos(theta_scatterer(k)) ; sin(phi_scatterer(k)) * sin(theta_scatterer(k)) ; cos(phi_scatterer(k)) ];
            % e = Rot_Matrix{b}.' * e;
            if dot( normal_vector{b} , e1{k,b} ) > 0
                Lambda(k,iota,b) = 1;
            else
                Lambda(k,iota,b) = 0;
            end
            h{k,b} = sparse( h{k,b} + sqrt(1/(K_rice+1)) * sqrt(M) * sqrt(Omega(k,b)) * Lambda(k,iota,b) * eta(k,iota) * 1/sqrt(M) * exp( 1j * 2*pi/lambda * Coor_Ele{b} * e1{k,b} ) );
        end
    end
end
% for k = 1:K
%     H{k} = [];
%     for b = 1:B
%         H{k} = [H{k} ; h{k,b} ];
%     end
% end








end